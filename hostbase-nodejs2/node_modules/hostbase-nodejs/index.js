const path = require("path");
const fs = require('fs');
const { io } = require("socket.io-client");

var depid = null;
global.depid = depid;

fs.readFile(path.resolve('./info.json'), {}, (err,data) => { if (err) throw err; global.depid=parseInt(JSON.parse(data)['deployment_id']) });

class StaticWebsite {
    constructor() {
        console.log("Waiting until HostBase deployment is ready...");
        this.socket = io("http://localhost/deployment-server");
        console.log(`Connecting via deployment server: /deployment-server/0`)
        setTimeout(() => {
            console.log(`Deployment ID: ${global.depid}`);
            console.log(`* Starting HostBase...`);
            console.log(`STATUS: Offline`);

            this.socket.connect();
        },2000);
    }

    run() {
        console.log(`STATUS: Online`);
    }

    setupEvents() {
        this.socket.on("connect", () => {
            console.log(`Communication successful! Socket ID is ${socket.id}`);
        });

        this.socket.on("disconnect", () => {
            console.log(`Uh oh! Socket has disconnected.`);
        });

        this.socket.on("reconnect_attempt", () => {
            console.log(`Trying to reconnect, website is offline.`);     
        });          
    }
}

module.exports = { StaticWebsite };